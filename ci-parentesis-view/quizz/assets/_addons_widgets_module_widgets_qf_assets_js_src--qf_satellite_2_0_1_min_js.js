function Satellite(a){this.config={attemps_limit:-1};this.messenger_stock={};this.dead=!1;this.c=0;$.extend(!0,this.config,a)}Satellite.prototype.send_message=function(a,d){var c=this,b="mid_"+this.c++;this.messenger_stock[b]={c:0,f:function(){}};this.pulse(a,d,0,b);this.messenger_stock[b].f=setInterval(function(){"undefined"!=typeof c.messenger_stock[b].c&&c.messenger_stock[b].c++;c.pulse(a,d,c.messenger_stock[b].c,b)},2E3)};
Satellite.prototype.pulse=function(a,d,c,b){if(!this.dead){var e=this.config.attemps_limit;if(0<=e&&c>=e)this.kill_messenger(b);else{console.log("pulse",b);var f=this;a.c=c;$.ajax({url:d,type:"post",dataType:"json",data:a,success:function(a){0<=$.inArray("suicide",a)?f.suicide():0<=$.inArray("ok",a)&&f.kill_messenger(b)}})}}};
Satellite.prototype.kill_messenger=function(a){a in this.messenger_stock&&"undefined"!=typeof this.messenger_stock[a].f&&(clearInterval(this.messenger_stock[a].f),this.messenger_stock[a].f=!1)};Satellite.prototype.suicide=function(){this.dead=!0;for(mid in this.messenger_stock)this.kill_messenger(mid)};